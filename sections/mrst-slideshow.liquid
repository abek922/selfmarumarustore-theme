{% comment %}
  MRST Slideshow (Swiper)
  - 既存 slideshow の構造を踏襲
  - 追加: コントロール外出し（inside / outside）
  - 追加: 外出し距離（px）、上下位置、中央寄せ/端揃え
  - 追加: セクショングループ "SELF 〇〇 STORE"

  注意:
  - スタイルは基本 add.css に寄せています（ここは最小限）
  - 既存の swiper 初期化が data 属性を見て自動で拾う前提
{% endcomment %}

{%- liquid
  assign container = section.settings.container
  assign color_scheme = section.settings.color_scheme
  assign autoplay = section.settings.autoplay
  assign autoplay_delay = section.settings.autoplay_delay | default: 5000

  assign controls_position = section.settings.controls_position | default: 'inside'  # inside | outside
  assign controls_v_align  = section.settings.controls_v_align  | default: 'center'  # top | center | bottom
  assign controls_outside_offset = section.settings.controls_outside_offset | default: 24
  assign controls_inside_gap = section.settings.controls_inside_gap | default: 8
  assign pagination_type = section.settings.pagination_type | default: 'bullets'     # bullets / none
  assign show_arrows = section.settings.show_arrows

  assign loop = section.settings.loop
  assign effect = section.settings.effect | default: 'slide' # slide/fade 等、既存に合わせて
-%}

{% style %}
  /* セクションスコープ変数（add.cssで上書き可） */
  #shopify-section-{{ section.id }} {
    --mrst-ctrl-outside-offset: {{ controls_outside_offset }}px;
    --mrst-ctrl-inside-gap: {{ controls_inside_gap }}px;
  }
{% endstyle %}

<section
  class="mrst-slideshow color-{{ color_scheme }} page-width page-width--{{ container }}"
  data-section-id="{{ section.id }}"
>
  <div
    class="mrst-slideshow__inner swiper"
    data-mrst-slideshow
    data-effect="{{ effect }}"
    data-loop="{{ loop }}"
    data-autoplay="{{ autoplay }}"
    data-autoplay-delay="{{ autoplay_delay }}"
    data-pagination="{{ pagination_type }}"
    data-arrows="{{ show_arrows }}"
  >
    <div class="mrst-slideshow__wrapper swiper-wrapper">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'slide' -%}
            {%- liquid
              assign image = block.settings.image
              assign mobile_image = block.settings.mobile_image | default: image
              assign heading = block.settings.heading
              assign subheading = block.settings.subheading
              assign text = block.settings.text
              assign button_label = block.settings.button_label
              assign button_link = block.settings.button_link
              assign content_position = block.settings.content_position | default: 'middle-center'
              assign content_align = block.settings.content_align | default: 'center'
              assign overlay = block.settings.overlay | default: 0
            -%}
            <div class="mrst-slideshow__slide swiper-slide" {{ block.shopify_attributes }}>
              <div class="mrst-slideshow__media">
                {%- if image -%}
                  <picture>
                    {%- if mobile_image -%}
                      <source
                        media="(max-width: 767px)"
                        srcset="{{ mobile_image | image_url: width: 960 }}"
                      >
                    {%- endif -%}
                    <img
                      src="{{ image | image_url: width: 1920 }}"
                      alt="{{ image.alt | escape }}"
                      width="{{ image.width }}" height="{{ image.height }}"
                      loading="lazy"
                      class="mrst-slideshow__img"
                    >
                  </picture>
                {%- endif -%}
                {%- if overlay and overlay > 0 -%}
                  <span class="mrst-slideshow__overlay" style="--overlay: {{ overlay | divided_by: 100.0 }};"></span>
                {%- endif -%}
              </div>

              <div class="mrst-slideshow__content mrst-slideshow__content--{{ content_position }} mrst-align-{{ content_align }}">
                {%- if subheading != blank -%}
                  <p class="mrst-slideshow__subheading">{{ subheading }}</p>
                {%- endif -%}
                {%- if heading != blank -%}
                  <h2 class="mrst-slideshow__heading">{{ heading }}</h2>
                {%- endif -%}
                {%- if text != blank -%}
                  <div class="mrst-slideshow__text rte">{{ text }}</div>
                {%- endif -%}
                {%- if button_label != blank and button_link != blank -%}
                  <a class="mrst-slideshow__btn btn btn--primary" href="{{ button_link }}">{{ button_label }}</a>
                {%- endif -%}
              </div>
            </div>
        {%- endcase -%}
      {%- endfor -%}
    </div>

    {%- comment -%}
      コントロール（矢印・ページネーション）
      - 位置 inside/outside を data 属性とラッパークラスで切替
    {%- endcomment -%}
    {%- if show_arrows or pagination_type != 'none' -%}
      <div class="mrst-controls-wrap mrst-controls-wrap--{{ controls_position }} mrst-v-{{ controls_v_align }}">
        {%- if show_arrows -%}
          <button class="mrst-swiper-button mrst-swiper-button--prev swiper-button-prev" aria-label="Previous"></button>
          <button class="mrst-swiper-button mrst-swiper-button--next swiper-button-next" aria-label="Next"></button>
        {%- endif -%}
        {%- if pagination_type != 'none' -%}
          <div class="mrst-swiper-pagination swiper-pagination" data-type="{{ pagination_type }}"></div>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "MRST Slideshow (Swiper)",
  "class": "mrst-slideshow-section",
  "settings": [
    {
      "type": "select",
      "id": "container",
      "label": "コンテナ幅",
      "options": [
        { "value": "full", "label": "全幅" },
        { "value": "fixed", "label": "固定" }
      ],
      "default": "fixed"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "カラー" },

    { "type": "checkbox", "id": "loop", "label": "ループ", "default": true },
    { "type": "checkbox", "id": "autoplay", "label": "自動再生", "default": true },
    { "type": "range", "id": "autoplay_delay", "label": "自動再生間隔（ms）", "min": 2000, "max": 10000, "step": 500, "default": 5000 },
    { "type": "select", "id": "effect", "label": "エフェクト", "options": [
      { "value": "slide", "label": "スライド" },
      { "value": "fade", "label": "フェード" }
    ], "default": "slide" },

    { "type": "header", "content": "SELF 〇〇 STORE — コントロール配置" },
    { "type": "select", "id": "controls_position", "label": "コントロール位置", "options": [
      { "value": "inside", "label": "内側（従来どおり）" },
      { "value": "outside", "label": "外側（スライド枠の外）" }
    ], "default": "inside" },
    { "type": "select", "id": "controls_v_align", "label": "矢印の縦位置", "options": [
      { "value": "top", "label": "上" },
      { "value": "center", "label": "中央" },
      { "value": "bottom", "label": "下" }
    ], "default": "center" },
    { "type": "range", "id": "controls_outside_offset", "label": "外側の横距離（px）", "min": 8, "max": 80, "step": 2, "default": 24 },
    { "type": "range", "id": "controls_inside_gap", "label": "内側の左右余白（px）", "min": 0, "max": 48, "step": 2, "default": 8 },

    { "type": "header", "content": "コントロールの表示/種類" },
    { "type": "checkbox", "id": "show_arrows", "label": "前へ/次へボタン", "default": true },
    { "type": "select", "id": "pagination_type", "label": "ページネーション", "options": [
      { "value": "bullets", "label": "ドット" },
      { "value": "none", "label": "なし" }
    ], "default": "bullets" }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "スライド",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "画像（PC）" },
        { "type": "image_picker", "id": "mobile_image", "label": "画像（SP任意）" },

        { "type": "inline_richtext", "id": "subheading", "label": "サブ見出し" },
        { "type": "inline_richtext", "id": "heading", "label": "見出し" },
        { "type": "richtext", "id": "text", "label": "本文" },
        { "type": "text", "id": "button_label", "label": "ボタン文言" },
        { "type": "url", "id": "button_link", "label": "ボタンリンク" },

        { "type": "select", "id": "content_position", "label": "コンテンツ位置", "options": [
          { "value": "top-left", "label": "上/左" },
          { "value": "top-center", "label": "上/中央" },
          { "value": "top-right", "label": "上/右" },
          { "value": "middle-left", "label": "中央/左" },
          { "value": "middle-center", "label": "中央/中央" },
          { "value": "middle-right", "label": "中央/右" },
          { "value": "bottom-left", "label": "下/左" },
          { "value": "bottom-center", "label": "下/中央" },
          { "value": "bottom-right", "label": "下/右" }
        ], "default": "middle-center" },
        { "type": "select", "id": "content_align", "label": "テキスト整列", "options": [
          { "value": "left", "label": "左" },
          { "value": "center", "label": "中央" },
          { "value": "right", "label": "右" }
        ], "default": "center" },
        { "type": "range", "id": "overlay", "label": "オーバーレイ（%）", "min": 0, "max": 80, "step": 5, "default": 0 }
      ]
    }
  ],
  "presets": [
    { "name": "MRST Slideshow (Swiper)", "category": "SELF 〇〇 STORE" }
  ]
}
{% endschema %}
